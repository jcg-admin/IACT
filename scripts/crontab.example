# ============================================================================
# IACT Project - Automated Maintenance Cron Jobs
# ============================================================================
#
# Instalacion:
#   1. Copiar este archivo: cp scripts/crontab.example /tmp/iact-crontab
#   2. Editar rutas si necesario: vi /tmp/iact-crontab
#   3. Instalar: crontab /tmp/iact-crontab
#   4. Verificar: crontab -l
#
# Nota: Asegurar que /var/log/iact existe y tiene permisos correctos
#
# ============================================================================

# Cleanup de sesiones expiradas - cada 6 horas (00:00, 06:00, 12:00, 18:00)
# Elimina sesiones expiradas de django_session en MySQL
# Reduce tamano de tabla y mejora performance
0 */6 * * * /home/user/IACT---project/scripts/cleanup_sessions.sh --force >> /var/log/iact/cleanup.log 2>&1

# Health check del sistema - cada 5 minutos
# Verifica: Django, PostgreSQL, MySQL, SESSION_ENGINE, migraciones
# RNF-002 compliance: valida SESSION_ENGINE = database (NO Redis)
*/5 * * * * /home/user/IACT---project/scripts/health_check.sh --json >> /var/log/iact/health.log 2>&1

# Backup diario de datos centralizados - 2:00 AM
# Backups: MySQL (dora_metrics), JSON logs
# Retention: 30 dias automatico
# NOTA: Configurar MYSQL_PASSWORD en environment o my.cnf
0 2 * * * MYSQL_PWD=${MYSQL_PASSWORD} /home/user/IACT---project/scripts/backup_data_centralization.sh >> /var/log/iact/backup.log 2>&1

# ============================================================================
# Opcional: Reportes DORA mensuales
# ============================================================================
# Generar reporte DORA automaticamente cada 1ro del mes a las 3:00 AM
# NOTA: Configurar GITHUB_TOKEN en environment
# 0 3 1 * * GITHUB_TOKEN=${GITHUB_TOKEN} /home/user/IACT---project/scripts/generate_dora_report.sh >> /var/log/iact/dora_cron.log 2>&1
