name: Emoji Validation

on:
  pull_request:
    paths:
      - '**.py'
      - '**.md'
      - '**.txt'
      - '**.js'
      - '**.ts'
      - '**.jsx'
      - '**.tsx'
      - '**.yaml'
      - '**.yml'
      - '**.json'
      - '**.sh'
      - '**.bash'
  push:
    branches:
      - main
      - develop
      - 'claude/**'

jobs:
  check-emojis:
    name: Check for Emojis
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Check for emojis in changed files
        run: |
          echo "Checking for emojis in project files..."
          echo "=========================================="
          echo ""

          # Get list of changed files (for PRs) or all files (for pushes)
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | grep -E '\.(py|md|txt|js|ts|jsx|tsx|yaml|yml|json|sh|bash)$' || true)
          else
            FILES=""
          fi

          # If no specific files or not a PR, check all files
          if [ -z "$FILES" ]; then
            echo "Running full project scan..."
            python scripts/workflows/check_no_emojis.py --all
          else
            echo "Checking changed files:"
            echo "$FILES" | while read file; do
              echo "  - $file"
            done
            echo ""
            python scripts/workflows/check_no_emojis.py $FILES
          fi

          EXIT_CODE=$?

          if [ $EXIT_CODE -ne 0 ]; then
            echo ""
            echo "=========================================="
            echo "VALIDATION FAILED: Emojis detected"
            echo "=========================================="
            echo ""
            echo "The IACT project has a strict NO EMOJI policy."
            echo ""
            echo "Please remove all emojis from your files."
            echo "See CONTRIBUTING.md for alternatives to common emojis."
            echo "See ANALISIS_POLITICA_NO_EMOJIS.md for detailed policy."
            echo ""
            echo "Common alternatives:"
            echo "  Instead of checkmark: [x] or 'OK' or 'PASS'"
            echo "  Instead of cross: [ ] or 'FAIL'"
            echo "  Instead of warning: 'WARNING:' or 'Nota:'"
            echo ""
            exit 1
          else
            echo ""
            echo "=========================================="
            echo "VALIDATION PASSED: No emojis detected"
            echo "=========================================="
            exit 0
          fi

      - name: Summary
        if: always()
        run: |
          echo "## Emoji Validation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### NO EMOJI Policy" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "This project enforces a strict NO EMOJI policy for:" >> $GITHUB_STEP_SUMMARY
          echo "- Code files (.py, .js, .ts, etc.)" >> $GITHUB_STEP_SUMMARY
          echo "- Documentation (.md, .txt)" >> $GITHUB_STEP_SUMMARY
          echo "- Scripts (.sh, .bash)" >> $GITHUB_STEP_SUMMARY
          echo "- Configuration files (.yaml, .yml, .json)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Why?" >> $GITHUB_STEP_SUMMARY
          echo "- Compatibility with all terminals/editors" >> $GITHUB_STEP_SUMMARY
          echo "- Accessibility for screen readers" >> $GITHUB_STEP_SUMMARY
          echo "- Professional technical documentation" >> $GITHUB_STEP_SUMMARY
          echo "- Easier searching and grepping" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Alternatives" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Instead of | Use |" >> $GITHUB_STEP_SUMMARY
          echo "|------------|-----|" >> $GITHUB_STEP_SUMMARY
          echo "| checkmark | [x] or 'OK' or 'PASS' |" >> $GITHUB_STEP_SUMMARY
          echo "| cross mark | [ ] or 'FAIL' |" >> $GITHUB_STEP_SUMMARY
          echo "| warning | 'WARNING:' or 'Nota:' |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "See [CONTRIBUTING.md](../CONTRIBUTING.md) for complete guidelines." >> $GITHUB_STEP_SUMMARY
          echo "See [ANALISIS_POLITICA_NO_EMOJIS.md](../ANALISIS_POLITICA_NO_EMOJIS.md) for detailed analysis." >> $GITHUB_STEP_SUMMARY
