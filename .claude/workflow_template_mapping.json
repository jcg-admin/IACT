{
  "$schema": "workflow-template-mapping-schema-v1",
  "version": "1.0.0",
  "description": "Mapeo centralizado entre workflows CI/CD, templates, procedimientos y agentes SDLC",
  "updated": "2025-11-06",

  "mappings": {
    "backend-ci": {
      "workflow": ".github/workflows/backend-ci.yml",
      "templates": [
        "docs/plantillas/plantilla_django_app.md",
        "docs/plantillas/plantilla_etl_job.md",
        "docs/plantillas/plantilla_tdd.md"
      ],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_desarrollo_local.md",
        "docs/gobernanza/procesos/procedimientos/guia_completa_desarrollo_features.md"
      ],
      "scripts": [
        "scripts/ci/backend_test.sh"
      ],
      "checklists": [
        "docs/gobernanza/procesos/checklists/checklist_desarrollo.md"
      ],
      "agentes": [],
      "triggers": ["push", "pull_request"],
      "paths": ["api/**", "scripts/**/*.py"],
      "validations": ["RNF-002", "tests", "coverage>=80", "lint"],
      "fase_sdlc": "development"
    },

    "frontend-ci": {
      "workflow": ".github/workflows/frontend-ci.yml",
      "templates": [],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_desarrollo_local.md"
      ],
      "scripts": [
        "scripts/ci/frontend_test.sh"
      ],
      "checklists": [
        "docs/gobernanza/procesos/checklists/checklist_desarrollo.md"
      ],
      "agentes": [],
      "triggers": ["push", "pull_request"],
      "paths": ["frontend/**"],
      "validations": ["tests", "lint", "build"],
      "fase_sdlc": "development"
    },

    "test-pyramid": {
      "workflow": ".github/workflows/test-pyramid.yml",
      "templates": [
        "docs/plantillas/plantilla_plan_pruebas.md",
        "docs/plantillas/plantilla_caso_prueba.md",
        "docs/plantillas/plantilla_tdd.md"
      ],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_qa.md"
      ],
      "scripts": [
        "scripts/ci/test_pyramid_check.sh"
      ],
      "checklists": [
        "docs/gobernanza/procesos/checklists/checklist_testing.md"
      ],
      "agentes": [
        "scripts/ai/agents/sdlc_testing.py"
      ],
      "triggers": ["push", "pull_request"],
      "paths": ["tests/**"],
      "validations": ["60% unit", "30% integration", "10% e2e"],
      "fase_sdlc": "testing"
    },

    "deploy": {
      "workflow": ".github/workflows/deploy.yml",
      "templates": [
        "docs/plantillas/plantilla_release_plan.md",
        "docs/plantillas/plantilla_deployment_guide.md",
        "docs/plantillas/plantilla_runbook.md"
      ],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_release.md"
      ],
      "scripts": [],
      "checklists": [],
      "agentes": [
        "scripts/ai/agents/sdlc_deployment.py"
      ],
      "runbooks": [
        "docs/implementacion/infrastructure/runbooks/verificar_servicios.md",
        "docs/implementacion/infrastructure/runbooks/merge_y_limpieza_ramas.md"
      ],
      "triggers": ["tag"],
      "paths": ["**"],
      "validations": ["blue-green", "health-checks", "rollback"],
      "fase_sdlc": "deployment"
    },

    "migrations": {
      "workflow": ".github/workflows/migrations.yml",
      "templates": [
        "docs/plantillas/plantilla_database_design.md"
      ],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_diseno_tecnico.md"
      ],
      "scripts": [],
      "checklists": [],
      "agentes": [
        "scripts/ai/agents/sdlc_design.py"
      ],
      "triggers": ["push", "pull_request"],
      "paths": ["api/**/migrations/**"],
      "validations": ["dry-run", "conflicts", "backwards-compatibility"],
      "fase_sdlc": "design"
    },

    "infrastructure-ci": {
      "workflow": ".github/workflows/infrastructure-ci.yml",
      "templates": [
        "docs/plantillas/plantilla_setup_entorno.md"
      ],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_instalacion_entorno.md"
      ],
      "scripts": [],
      "checklists": [],
      "agentes": [],
      "triggers": ["push", "pull_request"],
      "paths": ["infrastructure/**", "provisioning/**"],
      "validations": ["terraform-validate", "ansible-lint"],
      "fase_sdlc": "infrastructure"
    },

    "security-scan": {
      "workflow": ".github/workflows/security-scan.yml",
      "templates": [],
      "procedimientos": [
        "docs/gobernanza/procesos/procedimientos/procedimiento_analisis_seguridad.md"
      ],
      "scripts": [
        "scripts/ci/security_scan.sh"
      ],
      "checklists": [],
      "agentes": [],
      "triggers": ["push", "schedule"],
      "paths": ["**/*.py", "**/*.js"],
      "validations": ["bandit", "secrets", "sql-injection", "RNF-002"],
      "fase_sdlc": "operations"
    },

    "incident-response": {
      "workflow": ".github/workflows/incident-response.yml",
      "templates": [
        "docs/plantillas/plantilla_troubleshooting.md"
      ],
      "procedimientos": [],
      "scripts": [],
      "checklists": [],
      "agentes": [
        "scripts/ai/agents/sdlc_orchestrator.py"
      ],
      "runbooks": [
        "docs/implementacion/infrastructure/runbooks/reprocesar_etl_fallido.md",
        "docs/implementacion/infrastructure/runbooks/verificar_servicios.md"
      ],
      "triggers": ["workflow_dispatch", "repository_dispatch"],
      "paths": [],
      "validations": ["auto-rollback", "alertas", "post-mortem"],
      "fase_sdlc": "operations"
    }
  },

  "reverse_mappings": {
    "by_template": {
      "plantilla_django_app.md": ["backend-ci"],
      "plantilla_etl_job.md": ["backend-ci"],
      "plantilla_tdd.md": ["backend-ci", "test-pyramid"],
      "plantilla_plan_pruebas.md": ["test-pyramid"],
      "plantilla_caso_prueba.md": ["test-pyramid"],
      "plantilla_release_plan.md": ["deploy"],
      "plantilla_deployment_guide.md": ["deploy"],
      "plantilla_runbook.md": ["deploy"],
      "plantilla_database_design.md": ["migrations"],
      "plantilla_setup_entorno.md": ["infrastructure-ci"],
      "plantilla_troubleshooting.md": ["incident-response"]
    },

    "by_procedimiento": {
      "procedimiento_desarrollo_local.md": ["backend-ci", "frontend-ci"],
      "guia_completa_desarrollo_features.md": ["backend-ci"],
      "procedimiento_qa.md": ["test-pyramid"],
      "procedimiento_release.md": ["deploy"],
      "procedimiento_diseno_tecnico.md": ["migrations"],
      "procedimiento_instalacion_entorno.md": ["infrastructure-ci"],
      "procedimiento_analisis_seguridad.md": ["security-scan"]
    },

    "by_agente": {
      "sdlc_testing.py": ["test-pyramid"],
      "sdlc_deployment.py": ["deploy"],
      "sdlc_design.py": ["migrations"],
      "sdlc_orchestrator.py": ["incident-response"]
    },

    "by_fase_sdlc": {
      "planning": [],
      "feasibility": [],
      "design": ["migrations"],
      "development": ["backend-ci", "frontend-ci"],
      "testing": ["test-pyramid"],
      "deployment": ["deploy"],
      "operations": ["security-scan", "incident-response"],
      "infrastructure": ["infrastructure-ci"]
    }
  },

  "template_metadata": {
    "plantilla_django_app.md": {
      "categoria": "desarrollo",
      "prioridad": "alta",
      "genera_artefacto": "Django app en api/callcentersite/apps/",
      "requiere_workflow": true,
      "workflows_requeridos": ["backend-ci"],
      "fase_sdlc": "development"
    },
    "plantilla_etl_job.md": {
      "categoria": "desarrollo",
      "prioridad": "alta",
      "genera_artefacto": "ETL job en scripts/etl/",
      "requiere_workflow": true,
      "workflows_requeridos": ["backend-ci"],
      "fase_sdlc": "development"
    },
    "plantilla_tdd.md": {
      "categoria": "desarrollo",
      "prioridad": "alta",
      "genera_artefacto": "Tests en tests/",
      "requiere_workflow": true,
      "workflows_requeridos": ["backend-ci", "test-pyramid"],
      "fase_sdlc": "development"
    },
    "plantilla_plan_pruebas.md": {
      "categoria": "testing",
      "prioridad": "media",
      "genera_artefacto": "Test plan document",
      "requiere_workflow": true,
      "workflows_requeridos": ["test-pyramid"],
      "fase_sdlc": "testing"
    },
    "plantilla_release_plan.md": {
      "categoria": "gestion",
      "prioridad": "alta",
      "genera_artefacto": "Release plan document",
      "requiere_workflow": true,
      "workflows_requeridos": ["deploy"],
      "fase_sdlc": "deployment"
    },
    "plantilla_deployment_guide.md": {
      "categoria": "infrastructure",
      "prioridad": "media",
      "genera_artefacto": "Deployment guide document",
      "requiere_workflow": true,
      "workflows_requeridos": ["deploy"],
      "fase_sdlc": "deployment"
    },
    "plantilla_database_design.md": {
      "categoria": "diseno",
      "prioridad": "alta",
      "genera_artefacto": "Database migrations",
      "requiere_workflow": true,
      "workflows_requeridos": ["migrations"],
      "fase_sdlc": "design"
    }
  },

  "workflow_generation_rules": {
    "cuando_usar_template": {
      "plantilla_django_app.md": "Al crear nueva Django app, el workflow backend-ci se ejecutara automaticamente al push",
      "plantilla_etl_job.md": "Al crear nuevo ETL job, el workflow backend-ci validara el codigo",
      "plantilla_release_plan.md": "Al crear release plan, usar workflow deploy con tag vX.Y.Z",
      "plantilla_database_design.md": "Al disenar DB, crear migraciones que seran validadas por workflow migrations"
    },

    "automatizacion": {
      "backend-ci": "Se ejecuta automaticamente al push en api/** o scripts/**/*.py",
      "test-pyramid": "Se ejecuta automaticamente al push en tests/**",
      "deploy": "Se ejecuta automaticamente al crear tag vX.Y.Z",
      "migrations": "Se ejecuta automaticamente al push en api/**/migrations/**",
      "security-scan": "Se ejecuta diariamente a las 2 AM + al push",
      "incident-response": "Se ejecuta manualmente via workflow_dispatch"
    }
  }
}
