@startuml UC-001_generar_reporte_metricas_secuencia
!define PRIMARY_COLOR #2C3E50
!define SECONDARY_COLOR #3498DB
!define SUCCESS_COLOR #27AE60
!define WARNING_COLOR #F39C12

skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true
skinparam BoxPadding 10

actor "Analista de\nNegocio" as Analista
participant "Sistema IACT\n(Frontend)" as Sistema
participant "API de Reportes" as API
participant "Base de Datos\nMétricas" as DB
participant "Generador PDF" as PDF
participant "Servicio Email" as Email

== Autenticación ==
Analista -> Sistema: 1. Solicita reporte
activate Sistema
Sistema -> Analista: 2. Muestra formulario de login
deactivate Sistema

Analista -> Sistema: 3. Proporciona credenciales
activate Sistema
Sistema -> Sistema: 4. Valida credenciales
Sistema -> Analista: 5. Autenticación exitosa
deactivate Sistema

== Selección de Período ==
Analista -> Sistema: 6. Solicita generar reporte
activate Sistema
Sistema -> Analista: 7. Muestra formulario de selección
deactivate Sistema

Analista -> Sistema: 8. Selecciona período (2024-Q1)
activate Sistema
Sistema -> Sistema: 9. Valida período

alt Período válido
    Sistema -> API: 10. GET /api/reportes/metricas?periodo=2024-Q1
    activate API

    == Consulta de Datos ==
    API -> DB: 11. SELECT métricas WHERE período = '2024-Q1'
    activate DB
    DB --> API: 12. Retorna dataset (1.250 registros)
    deactivate DB

    == Procesamiento ==
    API -> API: 13. Calcula KPIs\n(Tiempo promedio, satisfacción, etc.)
    API --> Sistema: 14. Retorna datos procesados (JSON)
    deactivate API

    Sistema -> Sistema: 15. Renderiza preview del reporte
    Sistema -> Analista: 16. Muestra preview con gráficos
    deactivate Sistema

    == Exportación Opcional ==
    Analista -> Sistema: 17. Confirma generación y exporta
    activate Sistema
    Sistema -> PDF: 18. Genera PDF con datos
    activate PDF
    PDF -> PDF: 19. Renderiza gráficos y tablas
    PDF --> Sistema: 20. PDF generado (reporte_2024_Q1.pdf)
    deactivate PDF

    Sistema -> Analista: 21. Ofrece descarga
    deactivate Sistema

    Analista -> Sistema: 22. Solicita envío por email
    activate Sistema
    Sistema -> Email: 23. Envía PDF adjunto
    activate Email
    Email --> Sistema: 24. Email enviado
    deactivate Email
    Sistema -> Analista: 25. Confirma envío exitoso
    deactivate Sistema

else Período inválido
    Sistema -> Analista: ERROR: Período fuera de rango válido
    deactivate Sistema
end

@enduml
