{
  "name": "CallCenter Django API - DevContainer",

  // ==========================================================================
  // DOCKER CONFIGURATION
  // ==========================================================================

  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",

  // ==========================================================================
  // LIFECYCLE HOOKS
  // ==========================================================================
  // Execution order:
  // 1. initializeCommand (HOST) - Validations before building container
  // 2. onCreateCommand (CONTAINER) - Basic setup (once)
  // 3. updateContentCommand (CONTAINER) - Install dependencies (once)
  // 4. postCreateCommand (CONTAINER) - Database setup and migrations (once)
  // 5. postStartCommand (CONTAINER) - Verification (every start)
  // ==========================================================================

  // HOST - Pre-initialization validations
  "initializeCommand": "bash infrastructure/devcontainer/scripts/init_host.sh",

  // CONTAINER - Initial setup (Python, Git, directories)
  "onCreateCommand": "bash infrastructure/devcontainer/scripts/on_create.sh",

  // CONTAINER - Install Python dependencies
  "updateContentCommand": "bash infrastructure/devcontainer/scripts/update_content.sh",

  // CONTAINER - Database setup and migrations
  "postCreateCommand": "bash infrastructure/devcontainer/scripts/post_create.sh",

  // CONTAINER - Quick verification on every start
  "postStartCommand": "bash infrastructure/devcontainer/scripts/post_start.sh",

  // ==========================================================================
  // FEATURES
  // ==========================================================================

  "features": {
    // CPython Precompilado (Instalador Personalizado - SPEC-INFRA-001 Fase 3)
    // Para generar el artefacto: make build-cpython VERSION=3.12.6
    // Para desarrollo local: usa artifactUrl con path local
    // Para producción: usa GitHub Release URL
    "./infrastructure/cpython/builder/installer": {
      "version": "3.12.6",
      // DESARROLLO LOCAL: Path relativo al workspace
      "artifactUrl": "/workspaces/${localWorkspaceFolderBasename}/infrastructure/cpython/builder/artifacts/cpython-3.12.6-ubuntu22.04-build1.tgz",
      // PRODUCCIÓN: Descomentar cuando el Release esté publicado
      // "artifactUrl": "https://github.com/2-Coatl/IACT---project/releases/download/cpython-3.12.6-build1/cpython-3.12.6-ubuntu22.04-build1.tgz",
      "installPrefix": "/opt/python",
      "skipValidation": false
    },
    "ghcr.io/devcontainers/features/git:1": {
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "installOhMyZsh": true,
      "upgradePackages": true,
      "username": "vscode",
      "userUid": "1000",
      "userGid": "1000"
    }
  },

  // ==========================================================================
  // CUSTOMIZATIONS
  // ==========================================================================

  "customizations": {
    "vscode": {
      // Extensions
      "extensions": [
        // Python
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.black-formatter",

        // Django
        "batisteo.vscode-django",

        // Database
        "mtxr.sqltools",
        "mtxr.sqltools-driver-pg",
        "mtxr.sqltools-driver-mysql",

        // Git
        "eamodio.gitlens",

        // Docker
        "ms-azuretools.vscode-docker",

        // Utilities
        "editorconfig.editorconfig",
        "ms-vscode.makefile-tools"
      ],

      // Settings
      "settings": {
        // Python - Apunta al CPython precompilado
        "python.defaultInterpreterPath": "/opt/python-3.12.6/bin/python3",
        "python.linting.enabled": true,
        "python.linting.pylintEnabled": false,
        "python.linting.flake8Enabled": true,
        "python.formatting.provider": "black",
        "python.testing.pytestEnabled": true,
        "python.testing.unittestEnabled": false,

        // Editor
        "editor.formatOnSave": true,
        "editor.rulers": [88, 120],
        "editor.tabSize": 4,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,

        // Terminal
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.profiles.linux": {
          "bash": {
            "path": "/bin/bash"
          },
          "zsh": {
            "path": "/bin/zsh"
          }
        }
      }
    }
  },

  // ==========================================================================
  // FORWARDED PORTS
  // ==========================================================================

  "forwardPorts": [
    8000,  // Django runserver
    5432,  // PostgreSQL
    3306   // MariaDB
  ],

  "portsAttributes": {
    "8000": {
      "label": "Django Application",
      "onAutoForward": "notify"
    },
    "5432": {
      "label": "PostgreSQL Database"
    },
    "3306": {
      "label": "MariaDB Database"
    }
  },

  // ==========================================================================
  // MOUNTS
  // ==========================================================================

  "mounts": [
    // Mount SSH keys for git operations
    {
      "source": "${localEnv:HOME}${localEnv:USERPROFILE}/.ssh",
      "target": "/home/vscode/.ssh",
      "type": "bind"
    }
  ],

  // ==========================================================================
  // POST-ATTACH COMMAND
  // ==========================================================================
  // Commands to run after attaching to the container (optional)

  // "postAttachCommand": "echo 'Container ready!'",

  // ==========================================================================
  // USER
  // ==========================================================================

  "remoteUser": "vscode",

  // ==========================================================================
  // WAIT FOR
  // ==========================================================================
  // Wait for services to be ready before continuing

  "waitFor": "postCreateCommand"
}